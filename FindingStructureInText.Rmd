---
title: "Text_TDA"
author: "Matt O'Reilly"
date: "1/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(nonlinearTseries)
library(TDAstats)
library(tidyverse)
library(dplyr)
library(readxl)
library(tm) #NLP
```


###Word Count Vectors
```{r}
text_data <- read_excel("./data/wordcount_vectors.xlsx")
text_vector_data <- text_data %>% select(wordcountvec)
```

```{r}
wordvec_list <- c()
for (i in 1:nrow(text_vector_data)){
  text_vector_data[i,] <- removePunctuation(as.character(text_vector_data[i,]))
  x <- as.list(text_vector_data[i,])
  wordvec_list <- c(wordvec_list, x)
}

wordvec_df <- as.data.frame(wordvec_list)
dd <- data.frame(matrix(ncol = 2225, nrow = 1106))
for (i in 1:1105){ #Change range depending on size of c
  c <- as.numeric(strsplit(as.character(wordvec_df[i]), "")[[1]])
  dd[i] <- c[[i]]
}
word_vec_df <- Filter(function(x)!all(is.na(x)), dd)
row.names(word_vec_df)<- NULL ; colnames(word_vec_df)<- NULL
word_vec_df <- t(word_vec_df)
```



```{r}
#Tech / Col 1
text_vector_matrix <- data.matrix(word_vec_df[,1])
tak <- buildTakens(text_vector_matrix,2,3)
plot(tak)
hom <- calculate_homology(tak,return_df = TRUE) 
hom_matrix <- calculate_homology(tak,return_df = FALSE) 
bar <- plot_barcode(hom_matrix)
hom <- hom %>%
  mutate(persistence = death-birth) %>%
  mutate(persistent = ifelse(persistence > 0.1, 1,0))
hom_matrix <- tibble(hom) %>% select(dimension, persistent)
hom_matrix <- tibble(hom_matrix) 
p1 <- hom_matrix[hom_matrix$persistent == '1',] 
text_homology<-rbind.data.frame(text_homology,p1)
bar
```
```{r}
#business / Col 2
text_vector_matrix <- data.matrix(word_vec_df[,2])
tak <- buildTakens(text_vector_matrix,2,3)
plot(tak)
hom <- calculate_homology(tak,return_df = TRUE) 
hom_matrix <- calculate_homology(tak,return_df = FALSE) 
bar <- plot_barcode(hom_matrix)
hom <- hom %>%
  mutate(persistence = death-birth) %>%
  mutate(persistent = ifelse(persistence > 0.1, 1,0))
hom_matrix <- tibble(hom) %>% select(dimension, persistent)
hom_matrix <- tibble(hom_matrix) 
p1 <- hom_matrix[hom_matrix$persistent == '1',] 
text_homology<-rbind.data.frame(text_homology,p1)
bar
```
###Word Frequencies with Tfidf Vectors
```{r}
text_data <- read_excel("./data/freq_vectors.xlsx")
text_vector_data <- text_data %>% select(wordfreqvec)
```

```{r}
wordvec_list <- c()
for (i in 1:nrow(text_vector_data)){
  x <- as.list(text_vector_data[i,])
  wordvec_list <- c(wordvec_list, x)
}

wordvec_df <- as.data.frame(wordvec_list)
dd <- data.frame(matrix(ncol = 2225, nrow = 1106))
for (i in wordvec_list){ #Change range depending on size of c
  print(i)
  #c <- as.numeric(strsplit(as.character(wordvec_df[i]), "")[[1]])
  #dd[i] <- c[[i]]
}
word_vec_df <- Filter(function(x)!all(is.na(x)), dd)
row.names(word_vec_df)<- NULL ; colnames(word_vec_df)<- NULL
word_vec_df <- t(word_vec_df)
```

```{r}
tech <- data.frame()
business <- data.frame()
sport <- data.frame()
entertainment <- data.frame()
politics <- data.frame()
text_homology <- data.frame()

#length(text_data['wordcountvec']
for (i in 1:ncol(word_vec_df)){
text_vector_matrix <- data.matrix(word_vec_df[,i])
tak <- buildTakens(text_vector_matrix,2,3)
#plot(tak)
hom <- calculate_homology(tak,return_df = TRUE) 
hom_matrix <- calculate_homology(tak,return_df = FALSE) 
bar <- plot_barcode(hom_matrix)
hom <- hom %>%
  mutate(persistence = death-birth) %>%
  mutate(persistent = ifelse(persistence > 0.1, 1,0))
hom_matrix <- tibble(hom) %>% select(dimension, persistent)
hom_matrix <- tibble(hom_matrix) 
p1 <- hom_matrix[hom_matrix$persistent == '1',] 
text_homology<-rbind.data.frame(text_homology,p1)
print(bar)
}

```

